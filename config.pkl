amends "assets/AppConfig.pkl"

domains {
  ["localhost:3498"] = new PlainRuleSpec {
    rules = Set(
      #"http.Method("GET") -> http.Path("/api/v1/account/42") => File("testdata/responses/sample.json", "application/json")"#,
      #"http.Method("POST") -> http.Path("/api/v1/account/42/withdraw") => Json(`{"name":"Ted.Tester"}`)"#,
      #" => Status(500)"#
      // For now we're skipping JS support
      // #"http.Method("GET") -> http.Path("/api/v1/account/42/withdraw") => JSFile("testdata/scripts/account_withdraw.js")"#
    )
  }

  ["v3.petstore"] = new OpenApiSpec {
    schemaPath = "testdata/petstore_v3.yaml"
  }

  ["v2.petstore"] = new OpenApiSpec {
    schemaPath = "testdata/petstore_v2.yaml"
  }

  ["star.wars"] = new GraphQlSpec {
    schemas = Set(new GraphSchemaSource{path = "testdata/star_wars_schema.graphql"})
    rules = Set(
      #"http.Method("POST") -> http.Path("/api/v1/graphql") -> graphql.Query("query { allFilms { films { director title } } }") => File("testdata/responses/star_wars_all_films.json", "application/json")"#,
      #"http.Method("POST") -> http.Path("/api/v1/graphql") -> graphql.QueryFromFile("testdata/queries/simple.gql") => File("testdata/responses/star_wars_all_films_with_producers.json", "application/json")"#
    )
  }
}

telemetry {
  logging {
    format = "text"
  }
}